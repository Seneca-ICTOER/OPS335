<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-A-Labs/lab2a">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-rc.1">
<link rel="icon" href="/OPS335/img/pwa/icon-512x512.png">
<link rel="manifest" href="/OPS335/manifest.json">
<meta name="theme-color" content="#DA291C">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#DA291C">
<link rel="apple-touch-icon" href="/OPS335/img/pwa/icon-192x192.png">
<link rel="mask-icon" href="/OPS335/img/pwa/icon-512x512.png" color="#DA291C">
<meta name="msapplication-TileImage" content="/OPS335/img/pwa/icon-512x512.png">
<meta name="msapplication-TileColor" content="#DA291C">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><title data-rh="true">Lab 2a | OPS335 - Open System Application Server</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://Seneca-ICTOER.github.io//OPS335/A-Labs/lab2a"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Lab 2a | OPS335 - Open System Application Server"><meta data-rh="true" name="description" content="Lab 2a"><meta data-rh="true" property="og:description" content="Lab 2a"><link data-rh="true" rel="icon" href="/OPS335/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://Seneca-ICTOER.github.io//OPS335/A-Labs/lab2a"><link data-rh="true" rel="alternate" href="https://Seneca-ICTOER.github.io//OPS335/A-Labs/lab2a" hreflang="en"><link data-rh="true" rel="alternate" href="https://Seneca-ICTOER.github.io//OPS335/A-Labs/lab2a" hreflang="x-default"><link rel="stylesheet" href="/OPS335/assets/css/styles.099fe1a9.css">
<link rel="preload" href="/OPS335/assets/js/runtime~main.4f7d0ceb.js" as="script">
<link rel="preload" href="/OPS335/assets/js/main.293728ce.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/OPS335/"><div class="navbar__logo"><img src="/OPS335/img/logo.svg" alt="Seneca College" class="themedImage_ToTc themedImage--light_HNdA"><img src="/OPS335/img/logo-dark.svg" alt="Seneca College" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">OPS335 - Open System Application Server</b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/OPS335/">Welcome to OPS335</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/OPS335/weekly-schedule">Weekly Schedule</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/OPS335/A-Labs/installation-lab0">Labs</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OPS335/A-Labs/installation-lab0">Installation Prep Lab 0</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OPS335/A-Labs/lab1">Lab 1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/OPS335/A-Labs/lab2a">Lab 2a</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OPS335/A-Labs/lab2b">Lab 2b</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OPS335/A-Labs/lab3">Lab 3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OPS335/A-Labs/lab4a">Lab 4a</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OPS335/A-Labs/lab4b">Lab 4b</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OPS335/A-Labs/lab5">Lab 5</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OPS335/A-Labs/lab6">Lab 6</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OPS335/A-Labs/lab7">Lab 7</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OPS335/A-Labs/lab8">Lab 8</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/OPS335/B-Assignments/assignment1-part1">Assignments</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/OPS335/C-ExtraResources/resources">Extra Resources</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/OPS335/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Labs</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Lab 2a</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Lab 2a - Packet Filtering Using iptables</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="objective-and-preparation">Objective and Preparation<a class="hash-link" href="#objective-and-preparation" title="Direct link to heading">​</a></h2><p>In this lab, you will learn how to use <strong>iptables</strong> to build a simple <strong>Linux firewall</strong> on your servers.</p><p>iptables is a very complex topic. Fortunately, you are not required to become an iptables expert, but by the end of the course, you should be able to use iptables to properly secure your servers.</p><p>You were exposed to iptables in your OPS235 course. You should refer to <a href="http://zenit.senecac.on.ca/wiki/index.php/Lab_6_Warnings_/_Debrief#Investigation_2:_Networking_Tweaks" target="_blank" rel="noopener noreferrer">OPS235</a> or <a href="https://prezi.com/akyqt4h40oel/iptables-packet-filtering/" target="_blank" rel="noopener noreferrer">OPS335</a> notes or find and use documentation to learn how to complete these tasks. You can also ask your professor or lab assistant during the lab for help when using iptables. Some basic iptables commands are provided in this lab for reference, but it is also essential that you know how to obtain help (man pages and online) in order to become self-reliant.</p><p><strong>firewalld</strong></p><p>In this course, we will be using <em>iptables</em>, <strong>not</strong> <em>firewalld</em>. Although firewalld can present information in the familiar iptables format, learning both would be too advanced at this point of learning Linux network administration. In the <a href="/OPS335/weekly-schedule">Prep for Labs</a>, you should have disabled and stopped the firewalld service: .</p><p>You can also check the status of the firewalld service by issuing the command. You can also check if the firewalld service is running by issuing <strong>iptables -L</strong> and noting a high volume of unexpected output (i.e. &quot;a strange result&quot;).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="online-resources">Online Resources<a class="hash-link" href="#online-resources" title="Direct link to heading">​</a></h3><ul><li><a href="https://en.wikipedia.org/wiki/Iptables#Overview" target="_blank" rel="noopener noreferrer">Overview</a> A excellent concise overview of iptables (ignore diagram).</li><li><a href="https://wiki.centos.org/HowTos/Network/IPTables" target="_blank" rel="noopener noreferrer">CentOS Wiki</a> Listing of basic commands (not all required to know).</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-firewalls-iptables-relate-to-the-labs-in-this-course">How Firewalls (iptables) Relate to the Labs in this Course<a class="hash-link" href="#how-firewalls-iptables-relate-to-the-labs-in-this-course" title="Direct link to heading">​</a></h3><p>We will use an example of setting up a firewall to secure a web server. You will be installing, configuring, protecting, and maintaining a web-server of one of your VMs in a later lab.</p><p><strong>The diagram displayed below shows how iptables can be used with a web-server:</strong></p><p><img loading="lazy" alt="Iptables" src="/OPS335/assets/images/Iptables-41593960263c3f4ed47eb8000073c778.png" width="560" height="350" class="img_ev3q"></p><p><strong>There are some important things to be aware of in terms of this diagram:</strong></p><ul><li>There are <strong>two sets</strong> of IPtables rules (chains) that apply: <strong>OUTPUT/INPUT on the client</strong> and <strong>INPUT/OUTPUT on the server</strong>. It is important to think about trafic from the perspective from the client as well as the server.</li><li>Outbound traffic is rarely blocked unless&lt; there is a security policy to prevent some kind of traffic. Even in that case, that security policy is usually performed on a router.</li><li><strong>Inbound traffic is of two distinct types</strong>. Our diagram shows:<ol><li><strong>New incoming connections</strong> (what you normally think of as <strong>inbound traffic</strong>): the web server receives a <strong>new incoming connection</strong>.</li><li><strong>Incoming data that client receives as a response from the server</strong>: the web page that the server sent back in the diagram above.</li><li>The analogy would be like making a telephone call:<ul><li>A <strong>NEW</strong> packet is like the phone ringing</li><li>An <strong>ESTABLISHED</strong> packet is the connection and the packet says &quot;hello&quot;, along with any further communication.</li><li>A <strong>RELATED</strong> packet would be the same person calling on a second line. (eg. a second connection that is made because of something that happened in the first, like an ftp transfer).</li></ul></li><li>We normally don&#x27;t want to do anything special for the response. It is safe to assume that <strong>a connection that was allowed to be established should be allowed to receive a response</strong>. This is accomplished with the following <strong>INPUT chain rule</strong> that should be there by default on your machines:</li></ol></li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ACCEPT     all  --  anywhere             anywhere             state RELATED,ESTABLISHED</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>Rules are applied to: chains</strong> (e.g. <em>input/output</em>) and contain information regarding the type of traffic they apply to. For example, <strong>protocols</strong> such as <em>tcp/udp/icmp</em>, <strong>port numbers</strong> such as <em>22</em> (<em>SSH</em>), <em>80</em> (<em>HTTP</em>), <em>443</em> (<em>SHTTP</em>), <strong>addresses</strong>, and many other things.</li><li>Let&#x27;s look at how these rules would apply to a simple web connection (HTTP - port 80):<ol><li>For the <em>request</em>, the <strong>source port (sport) for the example in the above diagram is 40112</strong> and the <strong>destination port (dport) is 80</strong></li><li>For the <em>response</em>, the <strong>source port (sport) is 80</strong> and the <strong>destination port (dport) is 40112</strong></li><li>Since the <strong>RELATED</strong>,<strong>ESTABLISHED</strong> rule already exists, we are only concerned about <strong>controlling</strong> the <strong>incoming traffic on the server</strong>, which in our example, <strong>the chain is: INPUT</strong>, the <strong>protocol is: tcp</strong>, and the <strong>destination is: port 80.</strong></li></ol></li><li><strong>Basically, most other services work in a similar way as discussed above.</strong></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="critical-iptables-elements">Critical iptables Elements<a class="hash-link" href="#critical-iptables-elements" title="Direct link to heading">​</a></h3><p>This may seem like another task to perform, but it is an essential task! You need to &quot;<em>become one</em>&quot; with basic iptables and focus on these important elements on this section, since you will be troubleshooting MANY connection issues with MANY VMs for labs and assignments! You need to become comfortable when using iptables to not only set policy, but troubleshoot and fix mistakes when you set your firewall policies!</p><p><em>The more you practice and get comfortable with iptables, the quicker you will be able to isolate and fix connection issues.</em></p><p>We don&#x27;t expect you to become firewall experts, but there are some basics that you need to become familiar for this and future labs:</p><ul><li>What is a <strong>chain</strong>?</li><li><strong>Which chain</strong> applies to which traffic?</li><li>What&#x27;s the <strong>default action</strong> for a chain and when that applies?</li><li>Understanding the differences between <strong>setting policies</strong>, <strong>adding rules</strong>, and <strong>inserting rules.</strong></li><li>In what <strong>order are the rules executed</strong>?</li><li><strong>Reading and/or creating a rule</strong> for a specific service. That includes a basic understanding of:<ul><li><strong>Protocols</strong></li><li><strong>Ports</strong></li><li>Source/Destination IPADDR</li><li>HWADDR (MAC Address)</li><li>Network Interface name</li></ul></li><li>The best way to learn that is to <strong>practice</strong>.</li></ul><p><strong>Record essential concepts from this section into your OPS335 lab log-book</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="investigation-1-preparation-and-getting-to-know-iptables">Investigation 1: Preparation and Getting To Know iptables<a class="hash-link" href="#investigation-1-preparation-and-getting-to-know-iptables" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="confirming-existing-network-connections">Confirming Existing Network Connections<a class="hash-link" href="#confirming-existing-network-connections" title="Direct link to heading">​</a></h3><p>Before proceeding with iptables, we should first verify that your <strong>host machine</strong> and <strong>VMs</strong> can connect with each other. We can also take the opportunity to record some observations which could be used for future labs.</p><p><strong>Perform the Following Steps:</strong></p><ol><li>Determine the <em>MAC</em> address of the virtual network device on your <strong>host machine</strong> and the <em>IP address</em> assigned to it. Record this information in your lab log book.</li><li>Launch all three of your <strong>VMs</strong>.</li><li>For each <strong>VM</strong>:<ul><li>Login as root.</li><li>Find the MAC address of the <strong>Network Interface</strong> and the <strong>IP address</strong> assigned to it. Record this information on your lab log book.</li></ul></li><li>Change to your <strong>host machine</strong>, open a terminal window, and perform the following connectivity tests for each vm:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ping</span><span class="token plain"> -c </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ip-of-vm</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ip-of-vm</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="default-vs-updated-firewall-rules-for-vms">Default vs Updated Firewall Rules for VMs<a class="hash-link" href="#default-vs-updated-firewall-rules-for-vms" title="Direct link to heading">​</a></h3><p>You should have learned in OPS235 how to view existing iptables rules with a command similar to: <strong>iptables -L -v</strong>. Although you may assume that this listing of rules should be empty, they may not be!</p><p>In fact, several rules were <strong>automatically added</strong> to your chains because you are using a <strong>virtual network</strong>. As an exercise, we will determine which of those rules were added when running a virtual network.</p><p><strong>Perform the Following Steps:</strong></p><ol><li>Leave your VMs running for this section (which seems counter-intuitive).</li><li>On your <strong>host machine</strong>, stop the <strong>libvirtd</strong> service (refer to <a href="http://zenit.senecac.on.ca/wiki/index.php/Init_vs_systemd#systemd_Command_Usage" target="_blank" rel="noopener noreferrer">systemctl</a> command), and <strong>restart</strong> the <strong>iptables</strong> service.</li><li>Run <strong>iptables -L -v</strong> but redirect the output to a text file called <strong>before.txt</strong> (you will be using this file later).</li><li>You should notice the virtual machine manager no longer lists your vms (i.e. vm1, vm2, or vm3).</li><li>Close and then restart the virtual machine manager. What Happens?<ul><li>What are the states of your VMs? Record your observations in your lab logbook.</li></ul></li><li>Close the virtual machine manager application window again.</li><li><strong>Restart</strong> the <strong>libvirtd</strong> service.</li><li>Now, restart the virtual machine manager (<strong>note</strong>: it should indicate that the virtual machine manager connecting - be patient and wait until you are prompted you to enter the root password). What happens? What is the status of your VMs?</li><li>What does this mean when you lose your vm connections (including the disruption of the libvirtd service)?<ul><li>Record your observations in your lab logbook.</li></ul></li><li>Re-issue <strong>iptables -L -v</strong> commands making certain to redirect output to a second file (<strong>after.txt</strong>). This should provide a listing of the new state of your firewall settings.</li><li>You now should have two text files representing the before and after states of your firewall. Compare differences between these two files using the <strong>diff</strong> command (You should have used this tool in <strong>ULI101</strong>).</li><li>Run <strong>diff -u before.txt after.txt</strong> and figure out how to read the output.</li><li>You can use these tools to compare any two text files, they often come in handy. Note in your lab logbook the iptables rules that were added automatically by the <strong>libvirtd</strong> service.</li><li>Are there any differences between those 2 files? What does this mean if your VMs get disconnected in terms of the firewall rules?</li></ol><p><strong>Graphically Compare File Differences:</strong> You can also install a graphical tool that makes it much easier to see differences: <strong>kompare before.txt after.txt</strong></p><p><strong>NOTE: Make certain to run the command as a regular user (i.e. NOT root!).</strong></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="practice-setting-firewall-rules-on-host-machine">Practice Setting Firewall Rules on Host Machine<a class="hash-link" href="#practice-setting-firewall-rules-on-host-machine" title="Direct link to heading">​</a></h3><p>We will run some iptables commands on your <strong>host machine</strong> to practice and get a basic understanding of how to set rules. We will NOT be saving the iptables rules in this section, so you don&#x27;t have to worry about &quot;messing-up&quot; your host machine - you can simply reboot your host machine to load the default iptables rules.</p><p>Let&#x27;s set a <strong>default policy</strong> to disable all inbound traffic:</p><ol><li><p>Issue an <em>iptables</em> command to set the default policy to disable all inbound traffic.</p></li><li><p>Issue an <em>iptables</em> command to list rules to verify you correctly disabled all inbound traffic.</p><ul><li>The remaining iptables rules will relate to that same <strong>inbound</strong> traffic chain:</li></ul></li><li><p>Issue the command <strong>iptables -L INPUT</strong>, and note the rules associated for ssh in your lab logbook.</p></li><li><p>Issue an <em>iptables command</em> to delete the default ssh rule, and issue another iptables command to verify.</p></li><li><p>Issue an <em>iptables command</em> to insert an iptables rule to ACCEPT SSH connections at the <strong>beginning</strong> of the chain (refer to your lab logbook for details).</p></li><li><p>Verify that you inserted that rule at the top of the INPUT chain, and then issue an iptable rule to delete that rule at the top of the chain (i.e. by number), and verify that that rule was deleted.</p></li><li><p>Issue an <em>iptables command</em> to append the SSH rule to the end of the chain, verify, delete that same rule, and verify.</p></li><li><p>Issue an <em>iptables command</em> to delete the related,established rule. Test your network connectivity between your hosts and vms. What happened?</p></li><li><p><strong>Shut down your VMs and reboot your host machine</strong>. What happens to the iptables rules you created for your host machine? Note in your OPS335 lab logbook how to save and restore your iptables rules, and what the difference of <strong>restoring iptables rules</strong> as opposed to <strong>flushing iptables rules</strong>.</p></li></ol><p><strong>Record steps, commands, and your observations in INVESTIGATION 1 in your OPS335 lab log-book</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="investigation-2-best-practices-and-customized-chains">Investigation 2: Best Practices and Customized Chains<a class="hash-link" href="#investigation-2-best-practices-and-customized-chains" title="Direct link to heading">​</a></h2><p>In this investigation, we will use shell scripting to help automate our firewalls, and create our own customized chains for packet filtering.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="best-practices-for-iptables">Best Practices for iptables<a class="hash-link" href="#best-practices-for-iptables" title="Direct link to heading">​</a></h3><p><strong>Refer to this &quot;best practices&quot; chart when using iptables:</strong></p><table><thead><tr><th>Tip</th><th>Explanation</th></tr></thead><tbody><tr><td><strong>Always back-up the default iptables settings</strong></td><td>When you install iptables in CentOS it already has some rules predefined. Make a copy of the file that creates these rules (including the ones that allow communication with your other machines). This way you can always restore them to have a functional machine even if you completely mess up your rules.</td></tr><tr><td><strong>Place your iptables commands (i.e. Rules) within a Bash shell script</strong></td><td>If you need to reset iptables, then you can run a shell script to quickly re-apply rules to save time.</td></tr><tr><td><strong>Don&#x27;t Panic if disconnected from a VM</strong></td><td>Some of the traffic between your host and VirtManager goes through IPtables. When you mess with IPtables rules on the host, you might end up losing the console connection to the virtual machines. <strong>Don&#x27;t worry, the virtual machines are still running and you can still use them once you re-establish your connection</strong>.</td></tr><tr><td><strong>If your most recent iptables Rule messes up your system</strong></td><td><strong>Reload the default rules</strong>. You can do that by restarting the iptables and libvirtd services (you can also do that at the beginning of your shell script). Then <strong>run your script with all the working iptables commands</strong> that you already finished. <strong>Return to work on creating the rule that didn&#x27;t work.</strong></td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-customized-chains">Creating Customized Chains<a class="hash-link" href="#creating-customized-chains" title="Direct link to heading">​</a></h3><p>You have the ability to create your own customized chains - you can actually name them!</p><p>The purpose of creating your own customized chains is to separate all the rules related to a single service (e.g. SSH, HTTP, FTP, ICMP, etc) from other unrelated rules.</p><p><strong>Perform the following steps for your host machine:</strong></p><ol><li><strong>Stop libvirtd</strong> and <strong>restart iptables</strong> so that you have only the minimal default rules.</li><li>Make a backup of the original default rules:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> /etc/sysconfig/iptables /etc/sysconfig/iptables.original</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li><p>Use the <strong>ifconfig</strong> or <strong>ip address</strong> command to determine the IP ADDRESS of your external facing address <!-- -->[<!-- -->ens33<!-- -->]<!-- --> (i.e. IP address beginning with <strong>192.168.40.x</strong> if you are using an SSD).</p></li><li><p>Open a terminal on the Windows machine and <strong>ping</strong> your external facing IP address of your Linux host (ens33). Was it successful? (it should have worked)</p></li><li><p>Change the <strong>default policy</strong> on the <strong>INPUT</strong> and <strong>FORWARD</strong> chains in the filter table to <strong>DROP</strong>.</p></li><li><p>Remove the rules from the <strong>INPUT</strong> and <strong>FORWARD</strong> chains (if any) that are <strong>rejecting</strong> all traffic (we are now better protected by the <em>default</em> policy).</p><ul><li>We will now create a new chain in order to create rules just relating to the <strong>ssh</strong> service:</li></ul></li><li><p>Create a new chain named <strong>MYSSH</strong> in the filter table. Refer to notes or other resources to learn now to name a chain.</p></li><li><p>Add a rule to the <strong>INPUT</strong> chain of your filter table that sends all <strong>ssh</strong> traffic to your <strong>MYSSH</strong> chain. <strong>Make sure this new rule follows (not preceeds) the RELATED,ESTABLISHED rule, so it doesn&#x27;t apply to existing connections!</strong></p><ul><li><strong>Note</strong>: Use <strong>--jump</strong> or <strong>-j</strong> (not -g or --goto) to move to a target.</li></ul></li><li><p>Add a rule to your <strong>MYSSH</strong> chain to accept all traffic on your virtual interface from <strong>192.168.X.0/24</strong> (i.e. your internal network).</p></li><li><p>Add a rule to the <strong>beginning of your MYSSH chain</strong> that allows traffic from the IP address of your main host (probably Windows or Mac) machine.</p></li><li><p>Add a rule to the <strong>end of the MYSSH chain</strong> to drop all remaining <strong>ssh</strong> connections, but to log these denied packets with log level &#x27;info&#x27; and log prefix &quot;DENIED BY MYSSH&quot; before doing so.</p></li><li><p>Remove the rule in your <strong>INPUT</strong> chain that was allowing all <strong>ssh</strong> traffic.</p></li><li><p>Issue <strong>iptables -L -v</strong> to view your firewall rules for your newly-created chain.</p></li></ol><p>Next we&#x27;ll create a new chain to handle rules relating only to the <strong>ICMP</strong> protocol (ping):</p><ol start="14"><li>Remove the rule in your <strong>INPUT</strong> chain that is allowing all <strong>icmp</strong>.</li><li>Make a new chain named <strong>MYICMP</strong>.</li><li>Insert a rule to the <strong>beginning of the INPUT chain</strong> to send <strong>ICMP</strong> packets to your <strong>MYICMP</strong> chain.</li><li>Find the <strong>IP ADDRESS</strong> and <strong>MAC address</strong> of your Windows machine&#x27;s internal facing interface (should be an internal address beginning with <strong>192.168.40.x</strong>).</li><li>Add a rule to your <strong>MYICMP</strong> chain that allows <strong>ICMP</strong> packets coming in from <strong>192.168.X.0/24</strong> (i.e. your internal network).</li><li>Insert a rule to the <strong>beginning of your MYICMP chain</strong> that denies <strong>ICMP pings</strong> originating with MAC address of your main host (probably Windows) machine.</li><li>Insert a rule to the <strong>beginning of your MYICMP chain</strong> that denies <strong>ICMP pings</strong> originating with IP address of your main host (probably Windows) machine.</li><li>Issue <strong>iptables -L -v</strong> to view your firewall rules for your newly-created chains.</li><li>Attempt to connect to your machine using the external facing address to ensure your rules are working.<ul><li><strong>NOTE</strong>: Your system logs (such as: <strong>/var/log/messages</strong> or in the case (using a customized chains) the command: <strong>journalctl --dmesg | grep MYSSH</strong> should also show your failed attempts to <strong>ssh</strong> to you with your <strong>customized</strong> message.</li></ul></li><li>When you are confident the rules are working, save them by running (<strong>Note</strong> <em>that this should not include the rules from the virtual network. They will always be added automatically when libvirtd starts.</em>)</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">iptables-save </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /etc/sysconfig/iptables</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="24"><li>Now start libvirtd again, and test that your firewall still allows the VMs to connect to the host and each other (ping and ssh). Do not continue until it works.</li></ol><p><strong>Backup your VMs!:</strong> You MUST perform a <strong>full backup</strong> of ALL of your VMs whenever you complete your <strong>OPS335 labs</strong> or when working on your <strong>OPS335 assignments</strong>. You should be using the dump or rsync command, and you should use the Bash shell script that you were adviced to create in order to backup all of your VMs.</p><p><strong>Record steps, commands, and your observations in INVESTIGATION 2 in your OPS335 lab log-book</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="completing-the-lab">Completing The Lab<a class="hash-link" href="#completing-the-lab" title="Direct link to heading">​</a></h2><p>Upon completion of this lab, your host machine has a firewall protecting it from unexpected traffic. You should now have a basic understanding of the commands necessary to modify firewalls using iptables. You will be building on these rules for the rest of the course.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="online-submission">Online Submission<a class="hash-link" href="#online-submission" title="Direct link to heading">​</a></h3><p>Follow the instructions for lab 2a on blackboard.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="exploration-questions">Exploration Questions<a class="hash-link" href="#exploration-questions" title="Direct link to heading">​</a></h2><ol><li>View your firewall rules using the output of the &#x27;iptables -L -n -v&#x27; command. Also save the output to a text file.</li><li>How could you display the log records generated by your invalid ssh attempts without including any unrelated entries.</li><li>What iptables rule would you need to add to your firewall to allow a maximum of 3 concurrent ssh connections from your host to your VM1?</li><li>Which rule in the MYICMP chain is actually responsible for denying icmp packets from your partner? Why?</li><li>Which optional module could be used to work with packets based on whether they are new connections or not?</li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Seneca-ICTOER/OPS335/tree/main/docs/A-Labs/lab2a.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/OPS335/A-Labs/lab1"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Lab 1</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/OPS335/A-Labs/lab2b"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Lab 2b</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#objective-and-preparation" class="table-of-contents__link toc-highlight">Objective and Preparation</a><ul><li><a href="#online-resources" class="table-of-contents__link toc-highlight">Online Resources</a></li><li><a href="#how-firewalls-iptables-relate-to-the-labs-in-this-course" class="table-of-contents__link toc-highlight">How Firewalls (iptables) Relate to the Labs in this Course</a></li><li><a href="#critical-iptables-elements" class="table-of-contents__link toc-highlight">Critical iptables Elements</a></li></ul></li><li><a href="#investigation-1-preparation-and-getting-to-know-iptables" class="table-of-contents__link toc-highlight">Investigation 1: Preparation and Getting To Know iptables</a><ul><li><a href="#confirming-existing-network-connections" class="table-of-contents__link toc-highlight">Confirming Existing Network Connections</a></li><li><a href="#default-vs-updated-firewall-rules-for-vms" class="table-of-contents__link toc-highlight">Default vs Updated Firewall Rules for VMs</a></li><li><a href="#practice-setting-firewall-rules-on-host-machine" class="table-of-contents__link toc-highlight">Practice Setting Firewall Rules on Host Machine</a></li></ul></li><li><a href="#investigation-2-best-practices-and-customized-chains" class="table-of-contents__link toc-highlight">Investigation 2: Best Practices and Customized Chains</a><ul><li><a href="#best-practices-for-iptables" class="table-of-contents__link toc-highlight">Best Practices for iptables</a></li><li><a href="#creating-customized-chains" class="table-of-contents__link toc-highlight">Creating Customized Chains</a></li></ul></li><li><a href="#completing-the-lab" class="table-of-contents__link toc-highlight">Completing The Lab</a><ul><li><a href="#online-submission" class="table-of-contents__link toc-highlight">Online Submission</a></li></ul></li><li><a href="#exploration-questions" class="table-of-contents__link toc-highlight">Exploration Questions</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">OPS335 - Open System Application Server</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/OPS335/">Contents</a></li><li class="footer__item"><a href="#" id="pwa-button" class="footer__link-item" hidden>Install as an App</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Seneca College.</div></div></div></footer></div>
<script src="/OPS335/assets/js/runtime~main.4f7d0ceb.js"></script>
<script src="/OPS335/assets/js/main.293728ce.js"></script>
</body>
</html>